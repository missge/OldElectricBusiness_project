// store.js
import Vue from 'vue'
import Vuex from 'vuex'

// 引入 axios
import axios from 'axios'
import router from '@/router'
import qs from 'qs'
import {setCookie,getCookie} from '../cookie/cookie.js'
Vue.use(Vuex)
var localhostStr='http://wcy.dealreal.com.cn'
// var localhostStr='http://10.0.0.48:8080/wxmanage'
const store = new Vuex.Store({
	state:{
		openId:getCookie('openId'),
		merId:getCookie('merId'),
		mobile:getCookie('mobile'),
		mallId:getCookie('mallId'),
		flag:'',
		method:getCookie('method'),
		wxName:getCookie('wxName'),
		wxHeadlmgUrl:getCookie('wxHeadlmgUrl'),
		merchantName:getCookie('merchantName'),
		localHostUrl: localhostStr,
		// 获取卡包
		CardInfo:{
			pramater:{openId:getCookie('openId'),mobile:getCookie('mobile')},
			url:localhostStr+'/getCardInfo.json',
			result:[],
			restAmt:''
		},
		// 菜品类目
		FoodCategory:{
			pramater:{openId:this.openId,merId:this.merId,mobile:this.mobile},
			url:localhostStr+'/searckGoodsFamily.json',
			result:[]
		},
	    // 点餐页
		GoodsInfo:{
			result:[],
			number:[],
	    	count:0,
	    	price:0
		},
	    qrCode: {
	      url: 'http://101.200.188.251:8085/gyapp_api/getPayQrcode.json',
	      pramater: {localHostUrl: '111111',merId: '0'},
	      result: [],
	    },
	    // 卡包记录
		PayRecord: { 
		  url:localhostStr+'/searchPayRecord.json',
	      pramater: {openId:getCookie('openId'),mobile:getCookie('mobile')},
	      result: [],
	      length:0
		}
	

	},
	actions: {
		getCardInfo(context){
	      axios.post(context.state.CardInfo.url,qs.stringify(context.state.CardInfo.pramater), {emulateJSON: true}).then(
	        function (res) {
	            if(!res.data.ret){
	            	context.state.CardInfo.restAmt=res.data.data.restAmt
	            	console.log(res.data.data.restAmt)
	            }else{
	              alert(res.data.descript)
	            }
	        })
		},
		getFoodCategory(context){
			context.state.FoodCategory.pramater.openId = context.state.openId
			context.state.FoodCategory.pramater.merId = context.state.merId
			context.state.FoodCategory.pramater.mobile = context.state.mobile
			axios.post(context.state.FoodCategory.url,qs.stringify(context.state.FoodCategory.pramater), {emulateJSON: true}).then(
				function (res) {
				    if(!res.data.ret){
				    	context.state.FoodCategory.result=res.data.data
						console.log(res.data.data)

						 setCookie('merchantName', res.data.data[0].merchantName,1000*60)
						 var haveCard=res.data.data[0].haveCard
						 if(!haveCard){
						 	router.push({path: '/noCard'})
						 }

				    }else{
				      alert(res.data.descript)
				    }
			})
		},
		getPayRecord(context){
			context.state.PayRecord.pramater.openId = context.state.openId
			context.state.PayRecord.pramater.mobile = context.state.mobile
			axios.post(context.state.PayRecord.url,qs.stringify(context.state.PayRecord.pramater), {emulateJSON: true}).then(
				function (res) {
				    if(!res.data.ret){
				    	context.state.PayRecord.result=res.data.data
						context.state.PayRecord.length=res.data.data.length
						router.push({path: '/MealCard'})
				    }else{
				      alert(res.data.descript)
				    }
			})
		},
	},	    

})

export default store